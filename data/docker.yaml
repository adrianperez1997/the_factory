- become: true
  hosts: virtual4
  name: Instalando docker y weave
  gather_facts: true
  tasks:
  - name: symlink /usr/bin/python -> /usr/bin/python3
    raw: |
      if [ -f /usr/bin/python3 ] && [ ! -f /usr/bin/python ]; then
        ln --symbolic /usr/bin/python3 /usr/bin/python;
      fi
    become: true
  - import_role:
      name: geerlingguy.docker
  - include_role:
      name: geerlingguy.docker
  - import_role:
      name: geerlingguy.repo-epel
    when: ansible_facts['os_family'] == "CentOS"
  - include_role:
      name: geerlingguy.repo-epel
    when: ansible_facts['os_family'] == "CentOS"
  - import_role:
      name: geerlingguy.pip
  - include_role:
      name: geerlingguy.pip
  - name: Install Docker Module for Python
    pip:
      name: docker
  - become: true
    get_url:
      dest: /usr/local/bin/weave
      url: http://git.io/weave
    name: Get weave url
  - become: true
    command: chmod a+x /usr/local/bin/weave
    name: change weave permissions
